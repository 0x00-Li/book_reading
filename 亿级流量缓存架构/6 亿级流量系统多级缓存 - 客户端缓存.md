# 6 亿级流量系统多级缓存 - 客户端缓存

## 回顾

lua进行服务端多级缓存

lua-resty-lrucache

lua-resty-redis

lua-resty-http

lus-resty-template



## 客户端缓存

缓存通用的模块：页面骨架

动态部分交给浏览器处理，利用客户端的并发

客户端级别进行一些细节缓存





未变更的内容，通过状态码返回302 不携带新的数据，直接使用客户端缓存



ETag 携带资源的hash

> 这个功能数据http1.1中的
>
> hash 可以加入，相关资源的具体变更时间
>
> 但是这个会浪费一定的计算资源





Cache-Control、LastModified、 Expires

http1.1版本的功能

max-age 以秒为单位



via 在CDN的资源才会有的标识



参数

|      |      |      |
| ---- | ---- | ---- |
|      |      |      |
|      |      |      |
|      |      |      |



## 浏览器缓存原则

- 首页 可以看做是框架，应该禁用缓存，以保证加载资源都是最新的
- 怀有一个场景，下我们希望禁用浏览器缓存，比如轮训api，上报数据
- 浏览器缓存很难完全禁用，大多通过版本号的方式、随机数等
- 只缓存200相应头的数据，像302这类跳转页面，不需要缓存
- 对于js，css这类可以缓存很久的数据，可以通过加版本号方式更新内容
- 不需要强一致性的内容，可以缓存时间长点
- 异步加载的数据，可以使用etag来进行数据校验
- server



## 应用缓存







---

lunacy
