# 12 亿级流量分级缓存架构设计  分布式事务



## 为什么分布式事务

### 传统事务的基本特性（ACID）



mysql 中，可以begin开始事务，rollback回滚事务，commit 提交事务

redolog 记录变更，undolog 回滚

spring中，使用Transcation标记事务

**原子性（Atomic）**

要么全部成功，要么全部失败，没有中间状态

**一致性（Consistency）**

在执行事务前后，事务外访问数据库的时候，数据都是一致的，要么是看到的是成功的，要么就是看到的失败的



**隔离性（Isolation）**

一个事务在完成之前，不会受到其他事务的影响



**持久性（Durability）**

会有持久化效果，改变是永久的

---

系统膨胀后

**分库分表**



数据库集群分布式存储方案，当前





**表的垂直拆分**

表的列拆为多个部分

- 减少查询的网络io
- 提高查询效率

**表的水平拆分**

按照行拆分

- 有效提高查询效率



**分库**

- 同样的库表结构
- 不同的数据库中
- 可以多节点存储
- 可以



### 微服务下的多库存储

回想CAP 定理和BASE理论

base理论通过随时部分可用性提高数据最终一致性



#### 强一致性





### 2PC

- 准备
- 提交

缺点

1. 单点问题，协调节点存在单点问题
2. 同步会存在并发等待
3. 协调节点有超时机制，但是执行 节点无超时机制
4. 占用资源 





### 3PC



增加了预备阶段，只是检测网络可用





### TCC

属于两阶段



