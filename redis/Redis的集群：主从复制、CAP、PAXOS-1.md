# Redis的集群：主从复制、CAP、PAXOS-1



单机，单节点、单点故障：

1. 单点故障
2. 容量有限
3. 压力（CPU和IO）

> AKF，一变多，需要解决数据一致性问题
>
> X轴：全量、镜像
>
> Y轴：数据分类，功能
>
> Z轴：优先级，逻辑再拆分

1. 横向增加副本，读写分离：但是解决不了容量有限和单点故障问提
2. 纵向拆分：数据按照功能，业务、逻辑，进行拆分：解决容量有限问题
3. 数据分片

所有节点，阻塞同步，强一致性，容易破坏可用性，放弃强一致性，异步同步：

1.  容忍数据丢失一部分
2. 容忍同步延迟

> 主从：偏向于读写分离
>
> 主备：备机不参与业务，主挂后，备替代主
>
> 
>
> HA对外高可用，主要对主做HA，表现集群可用



## 主从复制

>  Redis默认的使用的是一步复制，其特点是低延迟和高性能。



replicaof 



```
replica-serve-stale-data yes  # 数据同步完，才会提供服务，否则不提供数据

replica-read-only # 从是否只读模式

repl-diskless-sync # 是否经过磁盘同步，先写rdb的形式

repl-backlog-size # 同步过程，每次同步的量

min 配置
```



## sentinel

哨兵模式



监控一个程序



哨兵集群，投标，自动切换主备



可以通过

redis-server

redis-sentinel 

启动

配置文件，redis源码目录

```
port 26379
sentinel monitor mymaster 127.0.0.1 6379
```



