# zookeeper 原理 分布式配置注册发现

对zk节点的监听是一次性的，回调后，需要重新设置监听



## 分布式协调

1. 配置
2. 分布式锁



### 分布式配置

运行时的配置，动态变更

可以通过 zookeeper 中的data部分设置数据，然后watch相关配置







### 分布式锁



1. 争抢锁，只有一个人能获得锁
2. 获得锁的人（死锁问题），临时节点，伴随session存在
3. 获得锁的人成功了。释放锁
4. 锁被释放、删除，别人怎么知道的？
   1. 主动轮训，心跳。。。弊端：延迟，压力
   2. watch方式：解决延迟问题。。。弊端：一下子通知所有，产生压力
   3. 使用序列节点sequence+watch:watch前一个，才能最小的获得锁；成本：zk只给第二个发事件回调



锁的重入：