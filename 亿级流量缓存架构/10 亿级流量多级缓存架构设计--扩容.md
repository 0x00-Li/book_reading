# 10 亿级流量多级缓存架构设计--扩容

## 扩容

扩容的原因

单体应用 -> 平均

## 硬件和云服务器扩容

### 整机硬件

### CPU

### 网卡

千兆-> 万兆



### 内存

ECC 校验

### 磁盘

SCSI HDD(机械)，HHD（混合），SATA SSD、PCl-e SSD、 NVMe SSD





## 水平扩容

复制

统一入口 负载均衡

### 系统拆分

> 可以更有效的水平拆分

1. 系统间共享数据
2. 接口调用
3. 





## 分布式ID



并发场景下的ID生成策略

### 分布式id需求

- 全局唯一性：不能出现重复ID
- 递增：保障下一个id一定大于上一个id，例如十五版本号、im增量消息
- 信息安全：如果id是连续的，恶意用户爬取，就很容易了





### 分布式ID方案

#### 全局唯一数据库

集群中唯一一台数据库用于生成id

**特点**

- 实现简单
- 性能一般，扩展难
- 难维护



#### 数据库集群方案

奇偶数

步长不同



#### UUID

- 简单
- 不可读
  -   变种，替换或者增加字段来存储生成时间
-   生成性能好，没有网络开销
- 全球唯一，数据合并一般不会出问题
  -  mac地址，原子钟
  - 保证服务器时间不回退
-  
- 无法排序，没有递增关系
- 字符串空间大，查询效率低
- 数据库传输量大



#### zookeeper

> 带序号几点，重启后，会接着序号进行生成

- 有序，使用临时接地那序号
- 使用节点数据版本
- 并发性能不好

#### mongodb

使用 ObjectId

#### Redis



#### snowflake

- 严重依赖时钟