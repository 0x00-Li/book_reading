# 9.亿级流量多级缓存架构 服务降级

## 回顾

进行不同维度的进行格力

线程隔离

进程

集群

机房

读写

动静

爬虫

等



## 限流

限制流量涌入！=拒绝服务



降级

## 接入层限流

**`ngx_limit_conn_module`**





### 限流算法

**计数器**

简单粗暴

如：最大连接数等



**漏桶算法**

削峰

缓冲

消费速度固定 因为计算性能固定

保证桶不能忙



**令牌桶算法**

`ngx_limit_req_module`

在固定的时间窗口内，处理的请求处理数



> 区别：
>
> - 令牌桶按照固定的速率,生成令牌放入令牌桶中





`lua-resty-limit-traffic`







可以通过guava RateLimiter实现

## 降级

