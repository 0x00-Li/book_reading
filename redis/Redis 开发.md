# Redis 开发

击穿

穿透

雪崩

分布式锁

api



## 击穿

>  redis缓存中，中的key刚好过期（ttl，lru,lfu），造成并发访问数据库；击穿前，肯定发生了高并发；

1. 在key刚好过期的时候，大量请求到达

2. 第一个发现redis没有key的时候，设置setnx （相当于分布式锁）

3. 谁设置setnx成功的话，访问db，设置缓存

4. 其他未到达的阻塞等待

   ​	如果第一个人挂了怎么办？设置锁过期时间

   ​    线程没挂，但是锁自动过期了，怎么办？开多个线程，一个线程监控数据是否加载成功，一个更新锁的时间



## 穿透

> 从业务接收到的查询是你的系统根本不存在的数据库

通过布隆过滤器，分析数据是否存在

	1. client实现
 	2. 客户端包含算法，redis保存bitmap
 	3. redis实现布隆过滤器

> 布隆过滤，不能删除；可以使用布谷鸟过滤器



## 雪崩

> 大量的key同时失效；间接造成大量的访问到达DB

随机过期时间

分情况讨论：

1. 时间点无关：可以直接使用随机过期时间
2. 零点必须过期：强依赖击穿方案；也可以业务层增加判断零点，进行延迟处理。



## 分布式锁

> setnx
>
> 过期时间
>
> 多线程（守护线程）
>
> redisson 实现
>
> zookeeper 是最佳实现

redis实现分布式锁，比zookeeper 速度快

